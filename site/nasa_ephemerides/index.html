
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../low_thrust_trajectories/">
      
      
        <link rel="next" href="../custom_input/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Using NASA ephemerides - ASTRA</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integrating-nasa-ephemerides-for-solar-system-planets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ASTRA" class="md-header__button md-logo" aria-label="ASTRA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ASTRA
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Using NASA ephemerides
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/andreabellome/astra" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ASTRA repository
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ASTRA" class="md-nav__button md-logo" aria-label="ASTRA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ASTRA
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/andreabellome/astra" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ASTRA repository
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trips_to_jupiter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trips to Jupiter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deep_space_man/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trajectories with Deep-Space Manoeuvres
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../low_thrust_trajectories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Low-thrust trajectories
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Using NASA ephemerides
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Using NASA ephemerides
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#integrating-nasa-ephemerides-for-solar-system-planets" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating NASA ephemerides for Solar System planets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-nasa-ephemerides-for-small-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating NASA ephemerides for small objects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performing-asteroid-fly-bys-with-nasa-ephemerides-in-astra" class="md-nav__link">
    <span class="md-ellipsis">
      Performing asteroid fly-bys with NASA ephemerides in ASTRA
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom_input/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using custom input parameters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#integrating-nasa-ephemerides-for-solar-system-planets" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating NASA ephemerides for Solar System planets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-nasa-ephemerides-for-small-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating NASA ephemerides for small objects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performing-asteroid-fly-bys-with-nasa-ephemerides-in-astra" class="md-nav__link">
    <span class="md-ellipsis">
      Performing asteroid fly-bys with NASA ephemerides in ASTRA
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Using NASA ephemerides</h1>

<p>This page shows how to integrate NASA high-precision ephemerides in ASTRA. This is particularly useful when using different planetary systems or when trips to comets or asteroids are sought.</p>
<h2 id="integrating-nasa-ephemerides-for-solar-system-planets">Integrating NASA ephemerides for Solar System planets</h2>
<p>Before considering other bodies, let's consider the Solar System planets. As from the <a href="../install/">intallation guide</a>, one should have the following structure in the local directory:</p>
<pre><code class="language-pgsql">local-folder/
├── ASTRA
├── MICE_TOOLBOX/
    ├── mice/
        ├── Kernel/
            ├── de430.bsp
            ├── gm_de431.tpc
            ├── mar097.bsp
            ├── naif0012.tls
            ├── pck00010.tpc
            └── sat375.bsp
        └── mice
├── clearDeleteAdd.m
└── main_script.m
</code></pre>
<p>The <code>main_script.m</code> is the one we want to modify (see, for example the tutorial on <a href="../trips_to_jupiter/">trips to Jupiter</a> or <a href="https://github.com/andreabellome/astra/blob/main/astra_with_custom_eph_mice.m" target="_blank">this script</a>).</p>
<p>After having set-up all the input and the ASTRA environment, one needs to load the NASA ephemerides. This can be done by imposing that:</p>
<pre><code class="language-matlab">% --&gt; load MICE toolbox
MICE_path = './MICE_TOOLBOX' ;
addpath(genpath(MICE_path)); % --&gt; always include this
cspice_furnsh([MICE_path '/data.mk']);
</code></pre>
<p>In this way, one loads the kernels for planetary ephemerides. This is not sufficient. One needs to tell ASTRA which ephemerides it should use. The default ones are encoded in the script <a href="https://github.com/andreabellome/astra/blob/main/ASTRA/Ephemerides%20%26%20constants/Solar%20System/EphSS_cartesian.m" target="_blank">EphSS_cartesian.m</a>. To overwrite those, one can simply set:</p>
<pre><code class="language-matlab">INPUT.customEphemerides = @EphSS_from_mice;
</code></pre>
<p>In particular, the function <a href="https://github.com/andreabellome/astra/blob/main/ASTRA/Ephemerides%20%26%20constants/Eph_MICE_interface/EphSS_from_mice.m" target="_blank">EphSS_from_mice.m</a> allows to automatically use the NASA ephemerides.</p>
<p>That's it. </p>
<p>Then one can launch an optimization for the EVEMEJ similar to the tutorial on <a href="../trips_to_jupiter/">trips to Jupiter</a>. Obviously, the two optimizations should provide very similar result:</p>
<ul>
<li>the one with <strong>approximate ephemerides</strong> has a minimum cost of: <strong>8.94774 km/s</strong> and <strong>6.45038 years</strong></li>
<li>the one with <strong>NASA ephemerides</strong> has a minimum cost of: <strong>8.95409 km/s</strong>  and <strong>6.45038 years</strong></li>
</ul>
<p>which indeed are very close. Thus, if one needs to plan missions to any of the Solar System planet, the approximate ephemerides are suggested, as these are quite faster to compute with respect to high-precision ones.</p>
<p><strong>BUG DETECTED: currently, high-precision NASA ephemerides prevent ASTRA to be run in parallel mode when resonances are present in the sequence. A workaround to this is shown later, but a rearchitect is needed. This will be solved in the next update...</strong></p>
<h2 id="integrating-nasa-ephemerides-for-small-objects">Integrating NASA ephemerides for small objects</h2>
<p>A very interesting application for integrating NASA ephemerides into ASTRA is when one needs to plan missions to Solar System objects that are not planets (asteroids and/or comets). This opens a very wide range of possibilities in terms of mission design.</p>
<p>If one has properly set-up the MICE toolbox as from the <a href="../install/">intallation guide</a>, then the only thing that remains to do is to download the <code>.bsp</code> file containing the ephemerides of the desired object. <a href="https://github.com/andreabellome/astra/blob/main/download_nasa_ephemerides.m" target="_blank">EphSS_from_mice.m</a> shows how to do it and the steps are reported here.</p>
<p>As always, one needs to add ASTRA and MICE_TOOLBOX to the path:</p>
<pre><code class="language-matlab">% --&gt; load ASTRA
clearDeleteAdd; % --&gt; !!! ONLY CALL IT ONCE FOR SPEED

% --&gt; load mice
MICE_path = './MICE_TOOLBOX';
addpath(genpath(MICE_path)); % --&gt; always include this
cspice_furnsh([MICE_path '/data.mk']);
</code></pre>
<p>Then, one selects the central body, and the time-span for the ephemerides validity:</p>
<pre><code class="language-matlab">% --&gt; central ID (Sun in this case)
idcentral = 1;

% --&gt; lower and upper bounds for ephemerides
t0 = [ 2030 1 1 12 0 0 ];
tf = [ 2100 1 1 12 0 0 ];
</code></pre>
<p>One now needs the SPKID of the object (in this case a comet is used):</p>
<pre><code class="language-matlab">% --&gt; SPKID of the object (found at https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/)
spk_id = 1000508;
</code></pre>
<p>SPKID of small bodies can be found at <a href="https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/" target="_blank">NASA Small Body Database Lookup</a> page.</p>
<p>One finally specifies the folder where the file should be downloaded (default path is used here):</p>
<pre><code class="language-matlab">% --&gt; set the path where to save the ephemerides
spk_dir = pwd;
</code></pre>
<p>and finally one can call the NASA API:</p>
<pre><code class="language-matlab">% --&gt; run the code (if success=1 then everything is okay)
success = getSPK(num2str(spk_id), num2str(t0), num2str(tf), spk_dir, 'overwrite', 'on');
</code></pre>
<p>If everything is set-up properly, then one should have a file called <code>1000508.bsp</code> in the specified target folder.</p>
<p>ASTRA is now ready to be run with the newly-generated ephemerides. The set-up is very similar as before. The desired comet has now ID that is <code>1000508</code> and thus the ASTRA set-up will be like:</p>
<pre><code class="language-matlab">% --&gt; sequence to be optimized
INPUT.idcentral = 1; % --&gt; central body (Sun in this case)

seq = [ 3 2 3 3 1000508 ]; res = [ 2 1 3 ];

%%%%%%%%%% multi-rev. options %%%%%%%%%%
maxrev                        = 1;                                                          % --&gt; max. number of revolutions (round number)
chosenRevs                    = differentRuns_v2(seq, maxrev);                              % --&gt; generate successive runs
[INPUT.chosenRevs, INPUT.res] = processResonances(chosenRevs, res);                         % --&gt; process the resonances options
[INPUT.chosenRevs]            = maxRevOuterPlanets(seq, INPUT.chosenRevs, INPUT.idcentral); % --&gt; only zero revs. on outer planets
%%%%%%%%%% multi-rev. options %%%%%%%%%%

%%%%%%%%%% set departing options %%%%%%%%%%
t0 = date2mjd2000([2030 1 1 12 0 0]); % --&gt; initial date range (MJD2000)
tf = t0 + 5*365.25;                  % --&gt; final date range (MJD2000)
dt = 3;                            % --&gt; step size (days)
INPUT.depOpts = [t0 tf dt];
%%%%%%%%%% set departing options %%%%%%%%%%

%%%%%%%%%% set options %%%%%%%%%%
INPUT.opt      = 4;          % --&gt; (1) is for SODP, (2) is for MODP, (3) is for DATES - SODP, (4) is for YEARS - MODP
INPUT.vInfOpts = [0 5];      % --&gt; min/max departing infinity velocities (km/s)
INPUT.dsmOpts  = [1 Inf];    % --&gt; max defect DSM, and total DSMs (km/s)
INPUT.plot     = [1 1];      % --&gt; plot(1) for Pareto front, plot(2) for best traj. DV
INPUT.parallel = false;       % --&gt; put true for parallel, false otherwise
INPUT.tstep    = dt;         % --&gt; step size for Time of flight            
%%%%%%%%%% set options %%%%%%%%%%
</code></pre>
<p>Finally, one loads the ephemerides of the comet:</p>
<pre><code class="language-matlab">% --&gt; load custom ephemerides
MICE_path = './MICE_TOOLBOX';
addpath(genpath(MICE_path)); % --&gt; always include this
cspice_furnsh([MICE_path '/data.mk']);

spk_dir = [];           % --&gt; location of the bsp file with object ephemerides (if empty, then the current directory is used)
cspice_furnsh([ pwd '\' spk_dir '\' num2str(max(seq)) '.bsp']); % --&gt; load the object ephemerides
</code></pre>
<p>As before, the ephemerides as passed to ASTRA as:</p>
<pre><code class="language-matlab">INPUT.customEphemerides = @EphSS_from_mice_workaround;
</code></pre>
<p>Please, note that in this case the ephemerides are loaded with a workaround to prevent the aforementioned bug to appear. Basically, <a href="https://github.com/andreabellome/astra/blob/main/ASTRA/Ephemerides%20%26%20constants/Eph_MICE_interface/EphSS_from_mice_workaround.m" target="_blank">EphSS_from_mice_workaround.m</a> loads the approximate positions of the planets (that are proved to work well for planets), thus avoiding the bug, while for the desired object it uses the NASA kernels.</p>
<p>One notices here that a scan of 5 years is set-up for this specific example, and thus one has that <code>INPUT.opt=4</code> (i.e., every year, multi-objective dynamic programming is used).</p>
<h2 id="performing-asteroid-fly-bys-with-nasa-ephemerides-in-astra">Performing asteroid fly-bys with NASA ephemerides in ASTRA</h2>
<p>It has to be said that one can also write sequences of objects that simulate asteroids fly-bys. In this case, ASTRA will consider them as massless points in space (so zero sphere of influence). </p>
<p>Let's take the following example. </p>
<pre><code class="language-matlab">% --&gt; clear INPUT and define new ones
try clear INPUT; catch; end; clc;

% --&gt; sequence to be optimized
INPUT.idcentral = 1; % --&gt; central body (Sun in this case)
seq = [ 3 2 3 3 20348435 5 ]; res = [ 2 1 3 ];

%%%%%%%%%% multi-rev. options %%%%%%%%%%
maxrev                        = 1;                                                          % --&gt; max. number of revolutions (round number)
chosenRevs                    = differentRuns_v2(seq, maxrev);                              % --&gt; generate successive runs
[INPUT.chosenRevs, INPUT.res] = processResonances(chosenRevs, res);                         % --&gt; process the resonances options
[INPUT.chosenRevs]            = maxRevOuterPlanets(seq, INPUT.chosenRevs, INPUT.idcentral); % --&gt; only zero revs. on outer planets
%%%%%%%%%% multi-rev. options %%%%%%%%%%

%%%%%%%%%% set departing options %%%%%%%%%%
t0 = date2mjd2000([2037 1 1 0 0 0]); % --&gt; initial date range (MJD2000)
tf = t0 + 1*365.25;                  % --&gt; final date range (MJD2000)
dt = 2.5;                            % --&gt; step size (days)
INPUT.depOpts = [t0 tf dt];
%%%%%%%%%% set departing options %%%%%%%%%%

%%%%%%%%%% set options %%%%%%%%%%
INPUT.opt      = 2;          % --&gt; (1) is for SODP, (2) is for MODP, (3) is for DATES, (4) is for YEARS - MODP
INPUT.vInfOpts = [0 5];      % --&gt; min/max departing infinity velocities (km/s)
INPUT.dsmOpts  = [1 Inf];    % --&gt; max defect DSM, and total DSMs (km/s)
INPUT.plot     = [1 1];      % --&gt; plot(1) for Pareto front, plot(2) for best traj. DV
INPUT.parallel = true;       % --&gt; put true for parallel, false otherwise
INPUT.tstep    = dt;         % --&gt; step size for Time of flight            
%%%%%%%%%% set options %%%%%%%%%%

%%

% --&gt; load custom ephemerides
MICE_path = './MICE_TOOLBOX';
addpath(genpath(MICE_path)); % --&gt; always include this
cspice_furnsh([MICE_path '/data.mk']);

spk_dir = [];           % --&gt; location of the bsp file with object ephemerides

for inds = 1:length(seq)
    if seq(inds) &gt; 9
        cspice_furnsh([ pwd '\' spk_dir '\' num2str(seq(inds)) '.bsp']); % --&gt; load the object ephemerides
    end
end

INPUT.customEphemerides = @EphSS_from_mice_workaround;

%% --&gt; optimize using ASTRA

% --&gt; launch ASTRA optimization
OUTPUT = ASTRA_DP(seq, INPUT);
</code></pre>
<p>This considers an EVEEJ transfer with a fly-by with asteroid 20348435 (<a href="https://ssd.jpl.nasa.gov/tools/sbdb_lookup.html#/?sstr=20348435" target="_blank">348435 (2005 QM35)</a>) on the EJ leg, and a 2:1 resonance on the 3rd leg (i.e., on the EE one), and launching in 2037. The resulting sequence thus looks like the following:</p>
<pre><code class="language-matlab">seq = [ 3 2 3 3 20348435 5 ]; res = [ 2 1 3 ];
</code></pre>
<p>In this case, ASTRA considers that the asteroids has <strong>null mass (i.e., zero sphere of influence)</strong>, and the fly-by is performed at the arbitrary altitude of <strong>1000 km</strong>. The prerequisite is to have the <code>.bsp</code> file of the object in the current working directory, as shown in the previous section.</p>
<p>The following plot shows the resulting optimal trajectory. One notices the fly-by with the desired object on the EJ leg.</p>
<p><img alt="fig-pareto-2" src="../img/figECI_20348435.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
      
        <script src="../js/katex.js"></script>
      
    
  </body>
</html>